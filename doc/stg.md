# `stg`

`stg` is used to extract and process ABI representations from libabigail XML,
BTF and ELF/DWARF.

NOTE: This is a work in progress and should be considered *experimental*. All
arguments and behaviour are subject to change.

## Usage

```
stg
 [-i|--info]
 [-c|--counters]
 [-t|--times]
 [-u|--unstable]
 [-a|--abi|-b|--btf|-e|--elf] [file] ...
 [{-o|--output} {filename|-}] ...
   implicit defaults: --abi
```

## Input

The tool can be passed any number of inputs to combine into a unified ABI.

### Formats

*   `-a|--abi`

    Read ABI XML representation generated by libabigail's `abidw`. It is very
    strongly recommended that ABI XML be passed through `abitidy --all` first as
    `stgdiff` cannot resolve issues such as duplicate types in "untidy" XML.

*   `-b|--btf`

    Read ABI information from the `.BTF` ELF section. BTF only covers the C type
    system and can be obtained in the following ways:

    *   `gcc -gbtf` generates BTF instead of DWARF
    *   `clang -c -g -target bpf` works similarly, but only for BPF targets
    *   `pahole -J` reads existing DWARF debug information and adds BTF

*   `-e|--elf`

    Read ABI information, stored inside ELF in DWARF format.

    NOTE: Only ELF symbol information, and not DWARF type information, is
    currently processed.

## Merge

If multiple (or zero) inputs are provided, then a merge operation is run.

## Output

*   `-o|--output`

    Zero or more outputs can be requested. The filename `-` is recognised as a
    synonym for stdout.

    The output will be an ABI representation in STG's native format.

    NOTE: This functionality is currently stubbed out; no output occurs.

    NOTE: There are currently no format stability guarantees and this should be
    considered *completely experimental*.

*   `-u|--unstable`: Use internal node ids in the ABI representation, instead of
    stabilised external node ids.

    This is intended for debugging purposes.

## Diagnostics

*   `-i|--info`

    This causes the BTF and ELF parsers to dump information to stdout about the
    entities processed. This is primarily useful for debugging. In the case of
    BTF input, the output is intended to match the output of `bpftool btf dump
    file "$file" format raw`.

*   `-c|--counters`

    Report various internal counters and metrics.

*   `-t|--times`

    Print the durations of various processing phases.
